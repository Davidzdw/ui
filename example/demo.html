<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Musician's Toolkit</title>
  <script src="../dist/mt.js"></script>
  <script src="js/Tone9.js"></script>
  <meta name="viewport" content="width=200, initial-scale=1">
</head>
<body style="margin:0;padding;0">

  <!--
  Desktop
  Plan:
  Sequencer
  Pan
  Start/Stop button
  Dials/Numbers
  Sliders/Numbers
  Meter, Spectrogram





  -->


  <div style="font-size:25px;padding:10px">
    NexusUI Demo
  </div>


<!--
  <div id="drum" style="border:solid 1px #ccc;background-color:white;width:840px;padding:10px">
    <div>
      <div mt="toggle" id="power" style="width:40px;height:25px;float:left;margin:0px"></div>
      <span style="height:25px;line-height:28px;margin:0px 10px">Power On</span>
    </div>
    <div style="overflow:auto">
      <div mt="sequencer" id="sequencer" style="width:400px;height:50px;float:left;margin:10px 10px 10px 0px"></div>
      <div mt="dial" id="tempo" style="width:50px;height:50px;float:left;margin:10px 10px 10px 0px"></div>
    </div>
  </div> -->


  <div id="drone" style="border:solid 1px #ccc;background-color:white;width:242px;padding:20px;margin:0 auto;box-sizing:border-box">
    <div>
      <div mt="toggle" id="power" style="width:40px;height:25px;float:left;margin:0"></div>
      <span style="height:25px;line-height:28px;margin-left:10px">Power On</span>
    </div>
    <div style="overflow:auto">
    <!--  <div style="padding:25px 0px 0px;width:200px;overflow:auto">
        <div mt="select" id="waveform" style="width:100px;height:25px;"></div>
        <div style="display:inline-block;float:left;padding:3px 0px 0px">Pitch</div>
      </div> -->
      <div style="padding:15px 0px 0px;width:200px;overflow:auto">
        <div mt="slider" id="timbre" style="width:200px;height:25px;display:inline-block;"></div>
        <div mt="number" id="timbreNum" style="width:50px;height:25px;float:right"></div>
        <div style="display:inline-block;float:left;padding:3px 0px 0px">Brightness</div>
      </div>
      <div style="padding:15px 0px 0px;width:200px;overflow:auto">
        <div mt="pan" id="pan" style="width:200px;height:25px;display:inline-block;"></div>
        <div style="display:inline-block;float:left;padding:3px 0px 0px">Pan</div>
      </div>

      <div style="padding:15px 0px 0px;width:200px;overflow:auto">
        <div mt="position" id="filter" style="width:200px;height:200px;display:inline-block;"></div>
        <div style="display:inline-block;float:left;padding:3px 0px 0px">Filter</div>
      </div>

      <div>
        <div style="padding:15px 0px 0px;width:60px;overflow:auto;float:left">
          <div mt="dial" id="reverb" style="width:60px;height:60px;margin:0 auto"></div>
          <div style="text-align:center;padding:10px 0px 0px">Reverb</div>
        </div>
        <div style="padding:15px 0px 0px;width:60px;overflow:auto;float:left;margin-left:9px;">
          <div mt="dial" id="drive" style="width:60px;height:60px;margin:0 auto"></div>
          <div style="text-align:center;padding:10px 0px 0px">Drive</div>
        </div>
        <div style="padding:15px 0px 0px;width:60px;overflow:auto;float:left;margin-left:9px;">
          <div mt="dial" id="delay" style="width:60px;height:60px;margin:0 auto"></div>
          <div style="text-align:center;padding:10px 0px 0px">Delay</div>
        </div>

      </div>

    </div>
  </div>



<style>

body {
  font-family:helvetica;
  font-weight:300;
  background-color:#eee
}
.mt-ui {
  margin:0px;
}
</style>
</body>
<script>

  mt.context = Tone.context;
/*
  drum = mt.rack('drum');
  drum.sequencer.rows = 2
  drum.sequencer.columns = 16

  drum.power.on('change',function(v) {
    if (v) {
      drum.sequencer.start(50)
    } else {
      drum.sequencer.stop()
    }
  })

  var synth = new Tone.PolySynth(10, Tone.MembraneSynth).toMaster();

  drum.sequencer.on('step',function(v) {
    v.forEach(function(noteon,i) {
      if (noteon) {
        synth.triggerAttackRelease(mt.tune.note(0,i-3), "4n");
      }
    })
  })

  drum.tempo.min = 10
  drum.tempo.max = 200
  drum.tempo.on('change',function(v) {
    console.log(v)
    drum.sequencer.interval.ms(v)
  })
 */

/*
Notes:
radioButton.numberOfButtons
select.options
 */



  drone = mt.rack('drone');

  // drone.pitch1.numberOfButtons = 8;
  // drone.pitch2.numberOfButtons = 8;
  //
  // drone.waveform.options = ["sine","sawtooth"]

  droneSynth = {
    fm: new Tone.FMOscillator(100, "sawtooth", "sawtooth").start(),
    fm2: new Tone.FMOscillator(112.5, "sawtooth", "sawtooth").start(),
    vol: new Tone.Volume(-Infinity),
    pan: new Tone.Panner(0),
    filter: new Tone.Filter(100, "bandpass"),
    delay: new Tone.FeedbackDelay(1, 0.7)
  }

  droneSynth.delay.wet.value = 0.5;

  droneSynth.fm.chain( droneSynth.filter, droneSynth.vol, droneSynth.pan, Tone.Master);
  droneSynth.fm2.chain( droneSynth.filter, droneSynth.vol, droneSynth.pan, Tone.Master);

  droneSynth.fm.harmonicity.value = 2
  droneSynth.fm2.harmonicity.value = 2


  drone.power.on('change',function(v) {
    if (v) {
      droneSynth.vol.volume.rampTo(-20,2)
    } else {
      droneSynth.vol.volume.rampTo(-Infinity,2)
    }
  })

  drone.timbre.min = 0
  drone.timbre.max = 10
  drone.timbre.on('change',function(v) {
    droneSynth.fm.modulationIndex.rampTo(v,0.1)
    droneSynth.fm2.modulationIndex.rampTo(v,0.1)
  })
  drone.timbre.value = 0


  drone.pan.on('change',function(v) {
  //  console.log(droneSynth.pan.pan.value)
    droneSynth.pan.pan.value = v.value;
  })



  drone.filter.minX = 0
  drone.filter.maxX = 1000
  drone.filter.minY = 0
  drone.filter.maxY = 10

  drone.filter.on('change',function(v) {
    droneSynth.filter.frequency.value = v.x;
    droneSynth.filter.Q.value = v.y;
  })


/*
  var metal = new Tone.MetalSynth({
    frequency:500,
    envelope:{
      attack:0.001,
      decay:0.5,
      release:0.1
    },
    harmonicity:5.1,
    modulationIndex:20,
    resonance:2000,
    octaves:2.5
  }).toMaster();
  var loop = new Tone.Loop(function(time) {
    metal.frequency.value = mt.ri(100,500)
    metal.triggerAttackRelease(0.1,time)
  //  console.log(time);
}, 0.2).start()
*/

//var fmOsc = new Tone.FMOscillator("Ab3", "sine", "square").toMaster().start();


  Tone.Transport.start()

//  var player2 = new Tone.Player("./media/D-sharp.mp3")
  //play as soon as the buffer is loaded
//  player2.autostart = true;
//  player2.loop = true;

//  ui.oscilloscope.connect(player2)
//  ui.meter.connect(player2);
//  ui.spectrogram.connect(player2);

</script>
</html>
